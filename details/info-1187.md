# INFO-1187: Starter.exe - Automatische Überwachung und Neustart

## Kategorie
**New Feature** + **Optimization** | Starter.exe

## Beschreibung

Option hinzugefügt, die automatisch die Funktionalität des TCP-Socketserver der infoskop-Base.exe überwacht und nach einem Timeout einen Neustart der Anwendung auslöst. Diese Funktion ist standardmäßig aktiviert und kann abgeschaltet werden.

### Features

#### 1. Automatische Selbstüberwachung

Der Starter überwacht kontinuierlich den Socket-Server der infoskop-Base:
- **Default: AN** - Funktion ist standardmäßig aktiviert
- **Intelligenter Timeout**: Erhöht sich automatisch bei wiederholten Neustarts
- **Adaptive Logik**: Ermöglicht langwierigen Aktionen Erfolg bei wiederholten Versuchen

#### 2. Intelligente Timeout-Erhöhung

Besonderheit: Der Timeout erhöht sich automatisch wenn er eintritt:
- **Verhindert Endlos-Neustarts** bei langwierigen Operationen
- **Lernfähig**: Passt sich an tatsächliche Laufzeiten an
- **Reset beim Neustart**: Timeout wird zurückgesetzt nach erfolgreichem Neustart

#### 3. Erweiterte Fehlerprotokollierung

Der Starter dokumentiert seine Versuche, die Base zu erreichen im Fehlerfall:
- **report.dat**: Lokale Protokollierung aller Verbindungsversuche
- **Logcheck-Integration**: Inhalt wird in den Logcheck übertragen
- **Diagnostik**: Bessere Fehleranalyse bei Problemen

---

## Auswirkung

- **Komponente**: Starter.exe
- **Version**: 5.0.0
- **Kategorie**: Neue Funktion + Optimierung

---

## Technische Details

### Konfigurationsparameter (Base-config)

#### 1. Automatischer Neustart aktivieren/deaktivieren
```
server/restartWhenUnresponsive = 1
```
- **Standardwert**: `1` (aktiviert)
- **Wenn auf `0` gestellt**: Base wird nicht mehr automatisch neu gestartet, wenn der Base Socket-Server ausfällt

#### 2. Prüfintervall
```
server/lifesignToBaseInterval = 5000
```
- **Standardwert**: `5000` (5 Sekunden)
- **Beschreibung**: Intervall, in dem der Starter den Socket Server der infoskop-Base prüft
- **Einheit**: Millisekunden (ms)

#### 3. Timeout vor Neustart
```
server/lifesignRestartBusyBaseAfterInterval = 30000
```
- **Standardwert**: `30000` (30 Sekunden)
- **Beschreibung**: Zeit, die der infoskop-Base Socket Server nicht erreichbar sein darf, bevor er neu gestartet wird
- **Besonderheit**: Dieser Wert erhöht sich automatisch jedes Mal, wenn die Base beendet wird
- **Zweck**: Falls ein Kunde eine langwierige Aufgabe immer wieder versucht, bekommt sie eine Chance auf Erfolg
- **Reset**: Beim Neustart des Systems
- **Einheit**: Millisekunden (ms)

---

## Ablauf der Überwachung

```
1. Starter prüft alle 5s (lifesignToBaseInterval) den Base Socket-Server
   ↓
2. Wenn Base nicht antwortet:
   - Zähler startet (30s = lifesignRestartBusyBaseAfterInterval)
   ↓
3. Nach 30s ohne Antwort:
   - Starter beendet die Base
   - Timeout erhöht sich automatisch (z.B. auf 45s)
   ↓
4. Starter startet die Base neu
   ↓
5. Bei nächstem Timeout:
   - Jetzt 45s warten statt 30s (adaptive Erhöhung)
   ↓
6. Nach System-Neustart:
   - Timeout zurück auf 30s (Reset)
```

---

## Fehlerprotokollierung

### report.dat
Enthält detaillierte Informationen über:
- Zeitpunkte der Prüfungen
- Fehlgeschlagene Verbindungsversuche
- Durchgeführte Neustarts
- Aktuelle Timeout-Werte

### Logcheck-Integration
Der Inhalt von `report.dat` wird automatisch in den Logcheck übertragen:
- Zentrale Fehleranalyse
- Historie der Verbindungsprobleme
- Support-Diagnose vereinfacht

---

## Anwendungsfälle

### 1. Socket-Server stürzt ab
- **Problem**: Base läuft, aber Socket-Server antwortet nicht
- **Lösung**: Automatischer Neustart nach 30s
- **Ergebnis**: Minimale Downtime

### 2. Langwierige Datenbank-Operation
- **Problem**: Kunde führt komplexe Abfrage aus (>30s)
- **1. Versuch**: Timeout nach 30s → Neustart (Abfrage abgebrochen)
- **2. Versuch**: Timeout jetzt 45s → Kunde versucht erneut
- **3. Versuch**: Timeout jetzt 60s → Kunde versucht erneut → **Erfolg!**
- **Vorteil**: Adaptive Timeout-Erhöhung ermöglicht Erfolg

### 3. Permanente Probleme
- **Problem**: Base startet nicht korrekt
- **Protokollierung**: Alle Versuche in report.dat
- **Support**: Kann Problem über Logcheck analysieren

---

## Benutzernutzen

- **Verfügbarkeit**: Automatische Wiederherstellung bei Socket-Server-Ausfällen
- **Intelligenz**: Adaptive Timeouts für langwierige Operationen
- **Transparenz**: Ausführliche Protokollierung für Diagnose
- **Flexibilität**: Funktion kann deaktiviert werden, wenn nicht gewünscht
- **Zuverlässigkeit**: Minimiert Ausfallzeiten durch automatische Überwachung

---

## Deaktivierung (falls erforderlich)

Falls die automatische Überwachung nicht gewünscht ist:

```ini
[server]
restartWhenUnresponsive=0
```

**Hinweis**: Nur in Ausnahmefällen deaktivieren. Die Funktion erhöht die Systemstabilität erheblich.

---

## Zugehörige Änderungen

Siehe auch:
- **Dienstverwaltung**: Starter speichert Dienstnamen in Base-Config
- **HL7-Server-Überwachung**: Automatisches Überwachen von HL7 Servern
