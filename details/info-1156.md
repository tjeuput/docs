# INFO-1156: Starter.exe - Dienst-Installation korrupt

## Kategorie
**Bug Fix** | Starter.exe

## Beschreibung

Optimierungen für die Installation als Dienst, behebt einen Fehler, bei dem installierte Dienstnamen korrupt und nicht für Windows leserlich waren.

### Problem

Bei der Installation des Starter.exe als Windows-Dienst traten kritische Probleme auf:
- **Dienstnamen waren korrupt**: Unleserliche oder beschädigte Zeichen
- **Windows Service Manager**: Konnte den Dienst nicht korrekt anzeigen
- **Dienstverwaltung unmöglich**: Start, Stop, Neustart funktionierten nicht
- **Mehrfach-Installationen**: Besonders problematisch bei mehreren Bases auf einem Rechner

### Lösung

Die Dienst-Installationslogik wurde vollständig überarbeitet:
- **Korrekte Zeichenkodierung**: Windows-konforme Dienstnamen
- **Validierung**: Namen werden vor Installation geprüft
- **Eindeutigkeit**: Unterstützung für mehrere Instanzen auf einem System

Zusätzliche Verbesserungen:
- **Dienstverwaltung**: Starter speichert Dienstnamen in der Base-Config für spätere Versionen

---

## Auswirkung

- **Komponente**: Starter.exe
- **Version**: 5.0.0
- **Kategorie**: Fehlerbehebung + Optimierung

---

## Technische Details

### Fix für korrupte Dienstnamen
- **Problem**: Fehlerhafte Zeichenkodierung bei Dienstnamen-Generierung
- **Lösung**:
  - UTF-8/ASCII-konforme Namen
  - Sonderzeichen-Filterung
  - Windows Service API korrekt implementiert
  - Validierung vor Installation

### Neue Konfigurationsparameter

Der Starter schreibt jetzt informativ und für spätere Versionen seine Dienstnamen in die Base-Config, sofern diese einen abweichenden Installationsnamen haben (wie z.B. bei mehreren Bases auf einem Rechner der Fall):

```ini
[Server]
bname = Name des Dienstes der infoskop-Base
mname = Name des Dienstes vom MediaServer
```

---

## Mehrfach-Installation

Bei mehreren infoskop-Bases auf einem Rechner:
1. **Eindeutige Dienstnamen**: Jede Base erhält einen eigenen Dienstnamen
2. **Persistierung**: Namen werden in jeweiliger Base-Config gespeichert
3. **Update-Kompatibilität**: Spätere Updates können korrekte Dienste identifizieren
4. **Verwaltung**: Updater kann Dienste mit `/bname` und `/mname` Parametern steuern

---

## Updater-Integration

Der infoskop-Base-Updater unterstützt nun individuelle Dienstnamen:

```cmd
infoskop-Base-Updater.exe /bname "infoskop-Base-Praxis1" /mname "MediaServer-Praxis1"
```

**Parameter**:
- `/bname`: Dienstname der infoskop-Base (wenn nicht Standard "infoskop-Base")
- `/mname`: Dienstname des MediaServers (wenn abweichend)

**Vorteil**: Updater kann die korrekten Dienste beenden und wieder starten.

---

## Standard-Dienstname-Vergabe

Ab Version 5.0.0:
- **Ohne `/MULTIPLEBASES` Flag**: Standard-Name "infoskop-Base" wird verwendet
- **Mit `/MULTIPLEBASES` Flag**: Individueller Name wird vergeben (z.B. "infoskop-Base-2")

Dies verhindert Konflikte bei Mehrfach-Installationen.

---

## Benutzernutzen

- **Zuverlässigkeit**: Dienst installiert korrekt und ist verwaltbar
- **Mehrfach-Installation**: Unterstützung für mehrere Bases auf einem System
- **Update-Sicherheit**: Korrekte Dienst-Identifikation bei Updates
- **Transparenz**: Lesbare und verständliche Dienstnamen
- **Wartbarkeit**: Windows Service Manager kann Dienste korrekt anzeigen und steuern

---

## Zugehörige Änderungen

Siehe auch:
- **[INFO-1157](./info-1157.md)**: Ähnlicher Fix für MediaServerStarter
- **Updater**: Parameter `/bname` und `/mname` für individuelle Dienstnamen
- **[INFO-1187](./info-1187.md)**: Erweiterte Dienstverwaltung und Überwachung

---

## Installations-Szenarien

### Szenario 1: Einzelne Base (Standard)
```
Dienst: "infoskop-Base"
Config: Server/bname nicht gesetzt (Standard-Name)
```

### Szenario 2: Mehrere Bases
```
Base 1:
  Dienst: "infoskop-Base-Praxis1"
  Config: Server/bname = "infoskop-Base-Praxis1"

Base 2:
  Dienst: "infoskop-Base-Praxis2"
  Config: Server/bname = "infoskop-Base-Praxis2"
```

### Szenario 3: Update mit individuellen Namen
```cmd
# Updater kann nun korrekte Dienste identifizieren:
Updater.exe /bname "infoskop-Base-Praxis1" /mname "MediaServer-Praxis1"

Ablauf:
1. Stoppe Dienst "infoskop-Base-Praxis1"
2. Stoppe Dienst "MediaServer-Praxis1"
3. Führe Update aus
4. Starte Dienst "MediaServer-Praxis1"
5. Starte Dienst "infoskop-Base-Praxis1"
```
